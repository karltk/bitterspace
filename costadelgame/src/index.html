<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv='Content-type: text/html; charset=utf-8'>
		<meta charset='utf-8'>
		<title></title>
		<!--link rel='stylesheet' type='text/css' href='style.css'></link-->
		<script type='text/javascript' src='gene.js'></script>
		<style type='text/css'>
			#board
			{
				/*border: 1px solid black;*/
			}
		</style>
		<script type="text/javascript">
			var Board = function(sizex, sizey)
			{
				var tilesize = 14;

				var clear = function(canvas)
				{
					var ctx = canvas.getContext('2d');
					canvas.width  = sizex * tilesize+1;
					canvas.height = sizey * tilesize+1;
					ctx.clearRect(0, 0, canvas.width, canvas.height);
					
					ctx.strokeStyle = '#ccc';
					ctx.strokeWidth = '1px';
					for (var y = 0; y < sizey; ++y)
					for (var x = 0; x < sizex; ++x)
					{
						ctx.strokeRect(x * tilesize+0.5, y * tilesize+0.5, tilesize, tilesize);
					}
				}

				var drawCreature = function(canvas, creature) //x, y, color, orientation)
				{
					var x = creature.x;
					var y = creature.y;
					var color = creature.team == 0 ? '#DEA863' : '#4E6A82';
					var orientation = creature.direction;

					var ctx = canvas.getContext('2d');
					var cx = tilesize * x + Math.floor(tilesize / 2);
					var cy = tilesize * y + Math.floor(tilesize / 2);

					//ctx.strokeStyle = color;
					ctx.save();
					ctx.translate(cx, cy);
					ctx.rotate(orientation * Math.PI/2);
					ctx.fillStyle = color;
					ctx.beginPath();
					var f = Math.floor(tilesize / 3);
					ctx.moveTo( f, -f);
					ctx.lineTo( f,  f);
					ctx.lineTo(-f,  0);
					ctx.closePath();
					//ctx.stroke();
					ctx.fill();
					ctx.restore();
				}

				var drawFood = function(canvas, x, y)
				{
					var ctx = canvas.getContext('2d');
					var cx = tilesize * x + Math.floor(tilesize / 2);
					var cy = tilesize * y + Math.floor(tilesize / 2);

					ctx.save();
					ctx.translate(cx, cy);
					ctx.fillStyle = '#C25C31';
					ctx.beginPath();
					var rad = Math.floor(tilesize / 3);
					ctx.arc(0, 0, rad, 0, 2*Math.PI, true);
					ctx.closePath();
					ctx.fill();
					ctx.restore();
				}

				return {
					clear: clear,
					drawCreature: drawCreature,
					drawFood: drawFood,
				};
			};

			onload = function()
			{
				var canvas = document.getElementById('board');
				var boardx = 30;
				var boardy = 20;
				var board = new Board(boardx, boardy);
				var creatures = [];

				for (var i = 0; i < 10; ++i)
					creatures.push(new Creature(Math.floor(Math.random()*boardx), Math.floor(Math.random()*boardy), boardx, boardy, Math.floor(Math.random() * 2)));

				var drawState = function()
				{
					board.clear(canvas);
					for (creature in creatures)
						board.drawCreature(canvas, creatures[creature]);
					board.drawFood(canvas, 2, 2);
				}

				setInterval(function()
					{
						for (creature in creatures)
							creatures[creature].step();
						drawState();
					}, 1000
				);

				drawState();
			}

		</script>
	</head>
	<body>

		<canvas id="board">
		</canvas>

	</body>
</html>
